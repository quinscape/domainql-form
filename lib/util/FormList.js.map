{"version":3,"sources":["../../src/util/FormList.js"],"names":["Icon","props","className","FormList","renderToolbar","arrayHelpers","newObject","addLabel","formConfig","canAdd","extraToolbar","push","createLineContext","index","path","lineConfig","FormConfig","mergeOptions","options","schema","setFormContext","type","formikProps","renderRowToolbar","last","canRemove","canSort","removeCheck","minRows","swap","confirm","remove","name","keyField","emptyText","children","getPath","__DEV","fieldType","resolveType","Error","JSON","stringify","array","values","len","length","React","Component","propTypes","PropTypes","string","isRequired","bool","number","oneOfType","func","FORM_CONFIG_PROPTYPES","defaultProps","horizontal"],"mappings":"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","file":"FormList.js","sourcesContent":["import React from \"react\"\nimport PropTypes from \"prop-types\"\nimport FormConfig, { FORM_CONFIG_PROPTYPES } from \"./FormConfig\"\nimport withFormConfig from \"./withFormConfig\"\n\nimport toPath from \"lodash.topath\"\nimport get from \"lodash.get\"\n\nimport {\n    isListType,\n    unwrapNonNull\n} from \"./InputSchema\"\nimport { FieldArray } from \"formik\";\n\n\nfunction Icon(props)\n{\n    const { className } = props;\n\n    return (\n        <i className={ \"fas \" + className }/>\n    );\n}\n\nclass FormList extends React.Component {\n\n    static propTypes = {\n        name: PropTypes.string.isRequired,\n\n        canRemove: PropTypes.bool,\n        canSort: PropTypes.bool,\n        addLabel: PropTypes.string,\n        removeCheck: PropTypes.string,\n        minRows: PropTypes.number,\n\n        // triggers alternate list view: row selector and single row form\n        keyField: PropTypes.oneOfType([\n\n            // field name/path within the array element type\n            PropTypes.string,\n            // function that renders the description for the array element\n            PropTypes.func\n        ]),\n\n        // optional factory method to produce new values\n        newObject: PropTypes.func,\n        // render additional elements into the list toolbar\n        renderToolbar: PropTypes.func,\n        // render additional elements into the per row toolbars\n        renderRowToolbar: PropTypes.func,\n\n        ... FORM_CONFIG_PROPTYPES\n    };\n\n    static defaultProps = {\n        canRemove: true,\n        canSort: true,\n        minRows: 0,\n        addLabel : \"Add Object\",\n        removeCheck : \"Delete Row?\",\n        emptyText: \"No Rows\",\n\n        // we use horizontal mode as non-inherited default in FormList.\n        horizontal: true\n    };\n\n    render()\n    {\n        const { name, keyField, emptyText, children, formConfig } = this.props;\n\n        const path = toPath(formConfig.getPath(name));\n\n        // check type in development\n        if (__DEV)\n        {\n            const fieldType = formConfig.schema.resolveType(formConfig.type, path);\n\n            if (!isListType(unwrapNonNull(fieldType)))\n            {\n                throw new Error(\"FormList expected 'List' type: is \" + JSON.stringify(fieldType))\n            }\n        }\n\n        const array = get(formConfig.formikProps.values, path);\n        const len = array.length;\n        const last = len - 1;\n\n        return (\n            <FieldArray\n                name={ name }\n                render={\n                    arrayHelpers => {\n\n                        children(\n                            {\n                                array,\n                                arrayHelpers,\n                                renderRowToolbar: this.renderRowToolbar,\n                                renderToolbar: this.renderToolbar,\n                                createLineContext: this.createLineContext\n                            }\n                        )\n                    }\n                }\n            />\n        )\n    };\n\n    renderToolbar = (arrayHelpers) =>\n    {\n        const { newObject, addLabel, renderToolbar, formConfig } = this.props;\n\n        const canAdd = typeof newObject === \"function\";\n        const extraToolbar = typeof renderToolbar === \"function\";\n\n        return (\n            <React.Fragment>\n                {\n                    (canAdd || extraToolbar) &&\n                    <div className=\"btn-toolbar\">\n                        {\n                            canAdd &&\n                            <button\n                                type=\"button\"\n                                className=\"b-add btn btn-default\"\n                                onClick={ev => arrayHelpers.push(newObject())}\n                            >\n                                <i className=\"fas fa-plus\"></i>\n                                {\" \" + addLabel}\n                            </button>\n                        }\n                        {\n                            extraToolbar && renderToolbar(formConfig, arrayHelpers)\n                        }\n                    </div>\n                }\n                {\n                    (canAdd || extraToolbar) && <hr/>\n                }\n            </React.Fragment>\n        );\n    };\n\n    createLineContext = ( index, path) =>\n    {\n        const { formConfig } = this.props;\n\n        const lineConfig = new FormConfig(\n            FormConfig.mergeOptions(formConfig.options, this.props),\n            formConfig.schema\n        );\n\n        lineConfig.setFormContext(\n            formConfig.type,\n            path + \".\" + index,\n            formConfig.formikProps\n        );\n\n        return lineConfig;\n    };\n\n    renderRow(arrayHelpers, index, last, path)\n    {\n        const { children } = this.props;\n\n        return (\n            <FormConfig.Provider\n                key={ index }\n                value={ this.createLineContext(index, path) }\n            >\n                <div className=\"form-row\">\n                    <div className=\"col-md-9\">\n                        <div className=\"container-fluid\">\n                            {\n                                typeof children === \"function\" ? children(index, arrayHelpers) : children\n                            }\n                        </div>\n                    </div>\n                    <div className=\"col-md-3\">\n                        {\n                            this.renderRowToolbar(arrayHelpers, index, last )\n                        }\n                    </div>\n                </div>\n                <hr/>\n            </FormConfig.Provider>\n        );\n    }\n\n    renderRowToolbar = (arrayHelpers, index,last) =>\n    {\n        const { canRemove, canSort, removeCheck, renderRowToolbar, minRows } = this.props;\n\n        return (\n            <React.Fragment>\n                {\n                    renderRowToolbar && renderRowToolbar(arrayHelpers, index, last)\n                }\n                {\n                    canSort &&\n                    <div className=\"btn-group\" role=\"group\" aria-label=\"Sort Buttons\">\n                        <button\n                            type=\"button\"\n                            className=\"b-up btn btn-link\"\n                            aria-label=\"Move Item Up\"\n                            onClick={ ev => arrayHelpers.swap(index, index - 1) }\n                            disabled={ index === 0 }\n                        >\n                            <Icon className=\"fa-arrow-up\"/>\n                        </button>\n                        <button\n                            type=\"button\"\n                            className=\"b-down btn btn-link\"\n                            onClick={ ev => arrayHelpers.swap(index, index + 1) }\n                            aria-label=\"Move Item Down\"\n                            disabled={ index === last }\n                        >\n                            <Icon className=\"fa-arrow-down\"/>\n                        </button>\n                    </div>\n                }\n                {\n                    canRemove && minRows <= last &&\n                    <button\n                        type=\"button\"\n                        className=\"b-remove btn btn-link\"\n                        aria-label=\"Remove Row\"\n                        onClick={ ev => { if ( confirm(removeCheck) ) arrayHelpers.remove(index) } }\n                    >\n                        <Icon className=\"fa-times\"/>\n                    </button>\n\n                }\n            </React.Fragment>\n        )\n    }\n}\n\nexport default withFormConfig(FormList)\n"]}