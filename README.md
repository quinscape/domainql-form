# DomainQL Form

DomainQL Form is a wrapper around 
[formik](https://github.com/jaredpalmer/formik) that adds support for 
conversion and validation based on GraphQL Input types as generated by
by domainql. 

It follows bootstrap 4 form conventions and provides a convenient high-level
field abstraction over it.


## GraphQL Compatibility

In general, the library should work for all GraphQL backends, but it expects some 
scalar implementations of the domainql backend. These are the standard graphql-java
scalar types plus a `Timestamp` and `Date` scalar compatible with SQL date and 
timestamp.

## Usage

Assuming we have an GraphQL input type `FooInput`

```graphql schema
input FooInput {
  name: String!
  flag: Boolean
  num: Int!
  moneys: BigDecimal
  date: Date
}
```

This of course being part of a larger GraphQL schema.
 
When we query the GraphQL schema with an Introspection query as `SCHEMA` we
can build the following form.


```js
<GQLForm
    inputSchema={ new InputSchema( SCHEMA ) }
    type="FooInput"
    value={ foo }
    horizontal={ true }
    onSubmit={ (foo, actions) => {

        // ... your submit code, 
        // foo will have been converted to GraphQL types
    } }
    { ... control }
>
    {
        (formikProps) => {

            // standard formik props
            const { values } = formikProps;

            return (
                <React.Fragment>
                    <GQLField name="name"/>
                    <GQLField name="num"/>
                    <GQLField name="flag"/>
                </React.Fragment>
            );
        }
    }
</GQLForm>
```

## 

The `type` prop defines our input type as the base type to use for the form and the
`value` props provides the actual foo value.

Note the the `foo` object is just a natural GraphQL data snippet, GQLForm automatically
handles the conversion to string needed for fomik.

The `onSubmit` arrow function prop then receives the submit result again
as typed GraphQL data.   

The `horizontal` flag puts the whole form into horizontal mode and makes
all fields render horizontally. 

## GQLField abstraction

Domainql-form works based on a high-level field abstraction that tries to simplify the
components needed to express a form.

`<GQLField/>` is the standard field component which adapts to the underlying
type as much as possible. In this example we could have `name` would be 
a normal text input, `num` recognizes the underlying num field and automatically
validates the field to be an `Int` value.

Since `flag` is a `Boolean` field, GQLField will not render an input but a bootstrap 4
checkbox instead.

If the underlying type is a `Enum` type, GQLField will automatically render
a HTML select. 

( )Special Date and Timestamp widgets are still missing at this point. )

There are additional components for cases, in which the <GQLField/> versatility
reaches its limit:


### GQLTextArea


<GQLTextArea /> renders a form-group with a HTML textarea element. 

```js
<GQLTextArea
    cols={ 40 }
    rows={ 2 }
    name="field"
/>

```


### GQLSelect


<GQLSelect /> renders a form-group with a HTML select element. The user
must provide a list of values. 

```js
<GQLSelect 
    name="field" 
    values={ ['A','B','C'] }
    required={ true} 
/>
```

If the `required` attribute is false ( the default ), the component will add
an empty option in addition to the user given options. Setting it to true
requires a choice of one of the values.

## Configuration 

GQLForm and fields are controlled both by props inherited within the form as well
as a global form configuration that is accessible over the `FormConfig` module

### Global FormConfig

The global FormConfig contains the field renderer registration and other 
global defaults.

#### Global FormConfig: Field Renders

The versatility of GQLField is implemented by an extensible system of field
renderes that can be extended to change standard behavior or register new
components.

```js

FormConfig.register({
    rule: { type: "MyScalar" },
    renderer: ctx => ...
})

```
The renderer registration consists of two parts a rule object and renderer function.

The rule object can define values for the following fields:

Rule field | Description
-----------|--------------
type       | name of the form base type
fieldType  | Scalar field type name
name       | field name
kind       | GraphQL "kind" field

Every field defined on a rule object must match a field so that its renderer is
used for that field.

The renderer receives a fieldContext object.
 
#### Default Rules

By default, there are three rules defined:

Rule                   | Renderer Description
-----------------------|---------------------
fieldType == "Boolean" | Renders a checkbox group
kind == "Enum"         | Renders an enum select element
none                   | Default Renderer

.register() will either register an alernate default rule if the rule is `false`, otherwise
a new rule is added with highest precedence.


### Custom Field Implementations

 




